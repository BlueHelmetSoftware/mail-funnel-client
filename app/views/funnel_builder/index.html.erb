<% content_for :javascript do %>
  <%= javascript_include_tag 'campaign_funnel_builder_manifest' %>  
  <script type="text/javascript">
    window.mainPageTitle = 'Main Page';
                            			ShopifyApp.ready(function () {
                            				ShopifyApp.Bar.initialize({
                            					title: window.mainPageTitle,
                            					icon: '/shopify.png',
                            					buttons: {
                            						secondary: {
                            							label: "Mail-Funnel Home",
                            							href: "http://docs.shopify.com/embedded-app-sdk",
                            							target: 'new'
                            						}
                            					}
                            				});
                            			});
  </script>
<% end %>
<nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="<%= root_url %>">Mail Funnels</a>
    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li><a href="<%= root_url %>">Home <span class="sr-only">(current)</span></a></li>
        <li class="active"><a href="<%= funnel_path %>">Mail-Funnel-Builder</a></li>
        <li><a href="<%= root_url %>lists">Email Lists</a></li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <!--<li><a href="#">Link</a></li>-->
      </ul>
    </div>
  </div>
</nav>
<!--<link href="http://www.jqueryscript.net/css/jquerysctipttop.css" rel="stylesheet" type="text/css">-->
<!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css"-->
<!--integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">-->
<div class="container">
	<div class="col-xs-12">

	<!-- Mail Funnel Builder Title -->
		<legend>
			<h2>Mail Funnel Builder</h2>
		</legend>
	<!-- END Mail Funnel Builder Title -->

  	<div class="row">

  		<!-- START RIGHT SIDE PANELS -->
    	<div class="col-xs-12 col-sm-6 pull-right">

      		<!-- Campaign Info Panel -->
    		<div class="panel panel-primary">

      		<!-- Campaign Info Title -->
        	<div class="panel-heading">
          		<h3 class="panel-title">Campaign Info</h3>
        	</div>

        	<!-- Campaign Info Body -->
        	<div class="panel-body">
         		<h5><b>Campaign: </b><%= @campaign.name %></h5>
          	<h5><b>Hook: </b><%= @hook.name %></h5>
          	<h5><b>Email-List: </b><span id="email_list_name"><%= @email_list.name %></span></h5>
            <!-- Hidden Div to hold IDs -->
            <div class="hidden">
              <input type="number" id="current_app_id" value="<%= @app_id %>" />
              <input type="number" id="current_email_list_id_holder" value="<%= @email_list.id %>" />
              <input type="number" id="campaign_id_holder" value="<%= @campaign.id %>"/>
            </div>
            <!-- END Hidden Div -->
       		</div>

    	</div>
    	<hr>
    	<!-- END Campaign Info Panel -->
    	
    	<!-- Job Actions Panel -->
		<div class="panel panel-primary">

      		<!-- Campaign Info Title -->
        	<div class="panel-heading">
         		<h3 class="panel-title">Job Actions</h3>
        	</div>

        	<!-- Campaign Info Body -->
        	<div class="panel-body">
          		<button class="btn btn-primary" id="create_button">New Job</button>
                <button class="btn btn-danger" style="" id="delete_selected_button">Delete Selected Job</button>
                <button class="btn btn-success" style="" id="edit_selected_button">Edit Selected Job</button>
        	</div>

      	</div>	
      	<hr>
		<!-- END Job Actions Panel -->
		
		<!-- Select Campaign Email List Panel -->
		<div class="panel panel-primary">

      		<!-- Campaign Info Title -->
        	<div class="panel-heading">
         		<h3 class="panel-title">Change Campaign Email List</h3>
        	</div>

        	<!-- Campaign Info Body -->
        	<div class="panel-body">
        		<div class="col-xs-12">
          			<%= render 'main_interface/email_list_select' %>
          		</div>
        	</div>

      	</div>	
		<!-- END Selest Campaign Email List Panel -->

    </div>
    <!-- END RIGHT SIDE PANELS -->

    <!-- START Campaign Funnel Builder Flow Chart -->
    <style>
      .flowchart-operator-title {
        background-color: #008cba !important;
        color: #ffffff;
      }
    </style>
    <div class="col-xs-12 col-sm-6" id="funnel-builder-canvas">
      <input type="number" id="canvas_height_holder" class="hidden" value="<%= @height %>" />
    </div>
    <!-- END Campaign Funnel Builder Flow Chart -->

  </div>
</div>
</div>

<!-- REMOVED ALL JS THAT WAS HERE AND PUT IT IN SEPERATE FILE -->
<script type="text/javascript">
  
  
              	
  
  
              	
</script>
<div class="modal fade" tabindex="-1" role="dialog" id="modal_node_delete" aria-labelledby="#result_modal">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-header">
      <h4 class="modal-title" id="delete_job_label">Delete Job</h4>
    </div>
    <div class="modal-content">
      <span id="result_status_message"></span>
      <span id="node_delete_job_id"></span>?
			<!--TODO: Verify that this #node_status_acknowledge.click() succesfully reloads canvas -->
      <input type="btn btn-success" id="node_status_acknowledge" value="Ok"/>
    </div>
  </div>
</div>
<div class="modal fade" tabindex="-1" role="dialog" id="modal_node_delete" aria-labelledby="#modal_node_delete">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-header">
      <h4 class="modal-title" id="delete_job_label">Delete Job</h4>
    </div>
    <div class="modal-content">
      Job deleted succesfully!
			<span id="node_delete_job_id"></span>?
			<input type="btn btn-success" id="delete_selected_button_submit" value="Ok"/>
    </div>
  </div>
</div>
<div class="modal fade" tabindex="-1" role="dialog" id="modal_node_create" aria-labelledby="#modal_node_create">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Create New Job</h4>
      </div>
      <div class="modal-body">
        <%= render partial: "node_modal_form" %>
        <div class="list-group"> <!-- TODO: Dynamically fetch the value names from their ID's below -->
          <span class="list-group-item">
            <h6 class="list-group-item-heading">Campaign ID: </h6>
            <span class="list-group-item-text" id="node_update_campaign_id"></span>
          </span>
          <span class="list-group-item">
            <h6 class="list-group-item-heading">Hook Identifier:</h6>
            <span class="list-group-item-text" id="node_update_hook_identifier"></span>
          </span>
          <span class="list-group-item">
            <h6 class="list-group-item-heading">App ID:</h6>
            <span id="node_update_app_id"></span>
          </span>
          <span class="list-group-item">
            <h6 class="list-group-item-heading">Email List ID:</h6>
            <span class="list-group-item-text" id="node_update_email_list_id"></span>
          </span>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      <button type="button" id="new_job_submit" class="btn btn-primary">Create Job</button>
    </div>
  </div>
</div>
</div>
</div>
<div class="modal fade" tabindex="-1" role="dialog" id="modal_node_update" aria-labelledby="#modal_node_update">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Update Job</h4>
      </div>
      <div class="modal-body">
        <span class="list-group-item">
          <h6 class="list-group-item-heading">Executed:</h6>
          <span class="list-group-item-text" id="node_update_job_executed"></span>
        </span>
        <%= render partial: "node_modal_form" %>
        <div class="list-group"> <!-- TODO: Dynamically fetch the value names from their ID's below -->
          <span class="list-group-item">
            <h6 class="list-group-item-heading">Campaign ID: </h6>
            <span class="list-group-item-text" id="node_update_campaign_id"></span>
          </span>
          <span class="list-group-item">
            <h6 class="list-group-item-heading">Hook Identifier:</h6>
            <span class="list-group-item-text" id="node_update_hook_identifier"></span>
          </span>
          <span class="list-group-item">
            <h6 class="list-group-item-heading">App ID:</h6>
            <span id="node_update_app_id"></span>
          </span>
          <span class="list-group-item">
            <h6 class="list-group-item-heading">Job ID:</h6>
            <span class="list-group-item-text" id="node_update_job_id"></span>
          </span>
          <span class="list-group-item">
            <h6 class="list-group-item-heading">Email List ID:</h6>
            <span class="list-group-item-text" id="node_update_email_list_id"></span>
          </span>
          <span class="list-group-item">
            <h6 class="list-group-item-heading">Job Local Identifier:</h6>
            <span class="list-group-item-text" id="node_update_local_identifier"></span>
          </span>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      <button type="button" id="update_job_submit" class="btn btn-primary">Update Job</button>
    </div>
  </div>
</div>
</div>
</div>